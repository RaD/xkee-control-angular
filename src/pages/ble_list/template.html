<legend class="text-center">BLE устройства "{{ area?.title }}"</legend>
<div class="container-fluid px-2">
  <div class="row">
    <div class="col">
    @if (error) {
      <div class="alert alert-danger" role="alert">
        <fa-icon [icon]="faBluetooth" class="me-2"></fa-icon>
        {{ error }}
      </div>
    }
    
    @if (!bluetoothSupported) {
      <figure class="text-center">
        <blockquote class="blockquote">
          <p>Use Browser with BLE support</p>
        </blockquote>
        <figcaption class="blockquote-footer">
          Используйте современный браузер с поддержкой Web Bluetooth API
        </figcaption>
      </figure>
    }
    
    @if (bluetoothSupported && devices.length === 0 && !scanning && !error) {
      <figure class="text-center">
        <blockquote class="blockquote">
          <p>Нажмите "Обновить" для поиска BLE устройств...</p>
        </blockquote>
        <figcaption class="blockquote-footer">
          Убедитесь, что Bluetooth включен на вашем устройстве
        </figcaption>
      </figure>
    }
    
    @if (bluetoothSupported && devices.length === 0 && !scanning && error === 'Устройства не найдены') {
      <figure class="text-center">
        <blockquote class="blockquote">
          <p>Nothing found</p>
        </blockquote>
        <figcaption class="blockquote-footer">
          Попробуйте повторить поиск или убедитесь, что устройства включены
        </figcaption>
      </figure>
    }
    
    @if (scanning) {
      <div class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Поиск устройств...</span>
        </div>
        <p class="mt-2">Поиск BLE устройств...</p>
      </div>
    }
    
    @if (devices.length > 0) {
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Устройство</th>
              <th>Сигнал</th>
              <th>Статус</th>
            </tr>
          </thead>
          <tbody>
            @for (device of devices; track device.id) {
              <tr class="cursor-pointer" (click)="onDeviceClick(device)">
                <td>
                  <div class="d-flex align-items-center">
                    <fa-icon [icon]="faBluetooth" class="me-2 text-primary"></fa-icon>
                    <div>
                      <div class="fw-bold">{{ device.name }}</div>
                      <small class="text-muted">ID: {{ device.id }}</small>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <fa-icon [icon]="faSignal" [class]="getRssiClass(device.rssi)" class="me-2"></fa-icon>
                    <span [class]="getRssiClass(device.rssi)">{{ device.rssi }} dBm</span>
                  </div>
                </td>
                <td>
                  @if (device.connected) {
                    <span class="badge bg-success">Подключено</span>
                  } @else {
                    <span class="badge bg-secondary">Отключено</span>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>
  </div>
</div>

<!-- Add spacing to prevent overlap with bottom buttons -->
<div class="mb-5 pb-5"></div>

<!-- Desktop view buttons -->
<div class="d-none d-md-block">
  <div class="row mb-3">
    <div class="col-md-6">
      <div class="d-flex">
        <div class="d-grid" style="min-width: 120px;">
          <app-smart-button 
            kind="secondary"
            [icon]="faArrowLeft"
            text="Назад"
            (click)="router.navigate(['/areas', area?.pk, 'edit'])">
          </app-smart-button>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="d-flex justify-content-end">
        <div class="d-grid" style="min-width: 140px;">
          <app-smart-button 
            kind="primary"
            [icon]="faSync"
            [text]="scanning ? 'Поиск...' : 'Обновить'"
            [disabled]="!bluetoothSupported || scanning"
            (click)="onRefresh()">
          </app-smart-button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Mobile view buttons -->
<div class="d-md-none">
  <div class="mb-3 fixed-bottom">
    <div class="container-fluid">
      <div class="d-grid gap-2">
        <app-smart-button 
          kind="secondary"
          [icon]="faArrowLeft"
          text="Назад"
          (click)="router.navigate(['/areas', area?.pk, 'edit'])">
        </app-smart-button>
        <app-smart-button 
          kind="primary"
          [icon]="faSync"
          [text]="scanning ? 'Поиск...' : 'Обновить'"
          [disabled]="!bluetoothSupported || scanning"
          (click)="onRefresh()">
        </app-smart-button>
      </div>
    </div>
  </div>
</div>